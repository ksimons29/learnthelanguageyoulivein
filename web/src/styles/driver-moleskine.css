/**
 * Moleskine Premium Theme for Driver.js Product Tours
 *
 * A carefully crafted notebook experience that appeals to expats
 * and language learners who appreciate premium design.
 *
 * Design Philosophy:
 * - Each tour step feels like turning a page in a premium notebook
 * - Warm, inviting colors that don't feel "app-like"
 * - Subtle textures and depth that reward attention
 * - The coral ribbon marks your place in the tour
 */

/* ======================
   CSS CUSTOM PROPERTIES
   ====================== */

.driver-popover.moleskine-tour-popover {
  /* Moleskine colors */
  --mlsk-paper: #f8f3e7;
  --mlsk-paper-white: #fffdf8;
  --mlsk-binding: #0c6b70;
  --mlsk-binding-light: #e8f4f4;
  --mlsk-ribbon: #e85c4a;
  --mlsk-ribbon-hover: #d94e3e;
  --mlsk-ink: #1d262a;
  --mlsk-ink-soft: #2d3436;
  --mlsk-muted: #6c7275;
  --mlsk-stitch: rgba(108, 114, 117, 0.4);

  /* Shadows */
  --mlsk-shadow-page:
    0 1px 2px rgba(29, 38, 42, 0.08),
    0 4px 8px rgba(29, 38, 42, 0.06),
    0 12px 24px rgba(29, 38, 42, 0.04);
  --mlsk-shadow-stack:
    2px 2px 0 var(--mlsk-paper-white),
    2px 3px 4px rgba(29, 38, 42, 0.08),
    4px 4px 0 var(--mlsk-paper),
    4px 5px 6px rgba(29, 38, 42, 0.06);
}

.dark .driver-popover.moleskine-tour-popover {
  --mlsk-paper: #2a2d30;
  --mlsk-paper-white: #353840;
  --mlsk-binding: #3db4bb;
  --mlsk-binding-light: rgba(61, 180, 187, 0.15);
  --mlsk-ribbon: #f06b5b;
  --mlsk-ribbon-hover: #f7867a;
  --mlsk-ink: #f2ede4;
  --mlsk-ink-soft: #d4cfc5;
  --mlsk-muted: #a09a90;
  --mlsk-stitch: rgba(160, 154, 144, 0.3);

  --mlsk-shadow-page:
    0 1px 2px rgba(0, 0, 0, 0.2),
    0 4px 12px rgba(0, 0, 0, 0.3),
    0 12px 32px rgba(0, 0, 0, 0.2);
  --mlsk-shadow-stack:
    2px 2px 0 var(--mlsk-paper-white),
    2px 3px 6px rgba(0, 0, 0, 0.3),
    4px 4px 0 #252830,
    4px 5px 8px rgba(0, 0, 0, 0.25);
}

/* ======================
   OVERLAY - Warm Lamp Light
   ====================== */

.driver-overlay {
  /* Warm charcoal with subtle gradient feel */
  background: linear-gradient(
    180deg,
    rgba(29, 38, 42, 0.72) 0%,
    rgba(29, 38, 42, 0.65) 50%,
    rgba(29, 38, 42, 0.68) 100%
  ) !important;
}

.dark .driver-overlay {
  background: linear-gradient(
    180deg,
    rgba(10, 12, 15, 0.82) 0%,
    rgba(10, 12, 15, 0.75) 50%,
    rgba(10, 12, 15, 0.78) 100%
  ) !important;
}

/* ======================
   HIGHLIGHT STAGE
   ====================== */

.driver-active-element {
  z-index: 10001 !important;
  background-color: #f5efe0 !important;
  border-radius: 8px !important;
  /* Subtle glow to make highlighted element feel special */
  box-shadow: 0 0 0 4px rgba(248, 243, 231, 0.3) !important;
}

.dark .driver-active-element {
  background-color: #1a1d20 !important;
  box-shadow: 0 0 0 4px rgba(26, 29, 32, 0.4) !important;
}

/* ======================
   POPOVER - Premium Notebook Page
   ====================== */

.driver-popover.moleskine-tour-popover {
  /* Base setup */
  position: relative;
  overflow: visible;

  /* Paper background with subtle texture */
  background:
    /* Paper fiber texture */
    url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E"),
    /* Solid background */
    var(--mlsk-paper);
  background-blend-mode: overlay;

  /* Border - only on right and bottom for binding effect */
  border: none;
  border-right: 1px solid rgba(108, 114, 117, 0.15);
  border-bottom: 1px solid rgba(108, 114, 117, 0.1);

  /* Binding rule: square left (with binding), rounded right */
  border-radius: 0 12px 12px 0;

  /* Layered page stack shadow */
  box-shadow: var(--mlsk-shadow-page), var(--mlsk-shadow-stack);

  /* Generous padding for breathing room */
  padding: 24px 24px 20px 32px;

  /* Optimal reading width */
  max-width: 360px;
  min-width: 300px;

  /* Typography base */
  font-family: "Inter", system-ui, -apple-system, sans-serif;

  /* Smooth transitions */
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* Binding edge strip */
.driver-popover.moleskine-tour-popover::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 12px;
  background: var(--mlsk-binding);
  border-radius: 0;

  /* Stitching pattern */
  background-image: repeating-linear-gradient(
    to bottom,
    transparent 0px,
    transparent 8px,
    var(--mlsk-stitch) 8px,
    var(--mlsk-stitch) 10px,
    transparent 10px,
    transparent 18px
  );
  background-position: center;
  background-size: 2px 18px;
  background-repeat: repeat-y;
}

/* Coral ribbon bookmark at top */
.driver-popover.moleskine-tour-popover::after {
  content: '';
  position: absolute;
  top: -6px;
  left: 28px;
  width: 8px;
  height: 32px;
  background: linear-gradient(
    180deg,
    var(--mlsk-ribbon) 0%,
    var(--mlsk-ribbon) 85%,
    transparent 85%
  );
  border-radius: 0 0 2px 2px;
  /* Ribbon shadow */
  box-shadow: 1px 2px 4px rgba(232, 92, 74, 0.3);
  /* Ribbon notch at bottom */
  clip-path: polygon(0 0, 100% 0, 100% 85%, 50% 100%, 0 85%);
}

.dark .driver-popover.moleskine-tour-popover {
  background:
    url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"),
    var(--mlsk-paper);
  border-right-color: rgba(160, 154, 144, 0.1);
  border-bottom-color: rgba(160, 154, 144, 0.08);
}

/* ======================
   POPOVER ARROW - Page Corner Fold
   ====================== */

.driver-popover.moleskine-tour-popover .driver-popover-arrow {
  /* Reset default arrow */
  border: none !important;
  background: var(--mlsk-paper);
  /* Subtle shadow for depth */
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.08));
}

.driver-popover.moleskine-tour-popover .driver-popover-arrow-side-top,
.driver-popover.moleskine-tour-popover .driver-popover-arrow-side-bottom,
.driver-popover.moleskine-tour-popover .driver-popover-arrow-side-left,
.driver-popover.moleskine-tour-popover .driver-popover-arrow-side-right {
  border-color: var(--mlsk-paper) !important;
}

.dark .driver-popover.moleskine-tour-popover .driver-popover-arrow {
  background: var(--mlsk-paper);
}

.dark .driver-popover.moleskine-tour-popover .driver-popover-arrow-side-top,
.dark .driver-popover.moleskine-tour-popover .driver-popover-arrow-side-bottom,
.dark .driver-popover.moleskine-tour-popover .driver-popover-arrow-side-left,
.dark .driver-popover.moleskine-tour-popover .driver-popover-arrow-side-right {
  border-color: var(--mlsk-paper) !important;
}

/* ======================
   TITLE - Elegant Serif
   ====================== */

.driver-popover.moleskine-tour-popover .driver-popover-title {
  font-family: "Libre Baskerville", Georgia, "Times New Roman", serif;
  font-size: 1.25rem;
  font-weight: 400;
  letter-spacing: -0.02em;
  line-height: 1.3;
  color: var(--mlsk-ink);

  /* Spacing */
  margin-bottom: 10px;
  padding-right: 24px; /* Space for close button */
}

/* ======================
   DESCRIPTION - Readable Body
   ====================== */

.driver-popover.moleskine-tour-popover .driver-popover-description {
  font-size: 0.9375rem;
  line-height: 1.6;
  color: var(--mlsk-ink-soft);

  /* Optimal line length */
  max-width: 42ch;

  /* Spacing */
  margin-bottom: 20px;
}

/* ======================
   PROGRESS - Page Number Style
   ====================== */

.driver-popover.moleskine-tour-popover .driver-popover-progress-text {
  /* Page number styling */
  font-family: "Libre Baskerville", Georgia, serif;
  font-size: 0.8125rem;
  font-style: italic;
  font-weight: 400;
  color: var(--mlsk-muted);

  /* Position at bottom left, like page numbers */
  position: absolute;
  bottom: 20px;
  left: 32px;
  margin: 0;

  /* Visual separator */
  padding-left: 0;
}

/* Add "Page" prefix via CSS */
.driver-popover.moleskine-tour-popover .driver-popover-progress-text::before {
  content: "Page ";
}

/* ======================
   NAVIGATION BUTTONS
   ====================== */

.driver-popover.moleskine-tour-popover .driver-popover-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-top: 8px;
  margin-top: 0;
  /* Make room for page number on left */
  padding-left: 80px;
}

.driver-popover.moleskine-tour-popover .driver-popover-navigation-btns {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

/* Base button styles */
.driver-popover.moleskine-tour-popover .driver-popover-prev-btn,
.driver-popover.moleskine-tour-popover .driver-popover-next-btn {
  padding: 10px 18px;
  font-size: 0.875rem;
  font-weight: 500;
  letter-spacing: 0.01em;
  border-radius: 8px;
  transition: all 180ms ease;
  cursor: pointer;
  border: none;
  position: relative;
  overflow: hidden;
}

/* Previous/Back button - Elegant ghost style */
.driver-popover.moleskine-tour-popover .driver-popover-prev-btn {
  background: transparent;
  color: var(--mlsk-binding);
  border: 1.5px solid var(--mlsk-binding);
}

.driver-popover.moleskine-tour-popover .driver-popover-prev-btn:hover {
  background: var(--mlsk-binding);
  color: var(--mlsk-paper);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(12, 107, 112, 0.25);
}

.driver-popover.moleskine-tour-popover .driver-popover-prev-btn:active {
  transform: translateY(0);
}

/* Next/Done button - Premium coral ribbon style */
.driver-popover.moleskine-tour-popover .driver-popover-next-btn {
  background: linear-gradient(
    180deg,
    var(--mlsk-ribbon) 0%,
    #d94e3e 100%
  ) !important;
  color: white !important;
  border: none !important;
  box-shadow:
    0 2px 4px rgba(232, 92, 74, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.driver-popover.moleskine-tour-popover .driver-popover-next-btn:hover {
  background: linear-gradient(
    180deg,
    #f06b5b 0%,
    var(--mlsk-ribbon) 100%
  ) !important;
  transform: translateY(-2px);
  box-shadow:
    0 4px 12px rgba(232, 92, 74, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.driver-popover.moleskine-tour-popover .driver-popover-next-btn:active {
  transform: translateY(0);
  box-shadow:
    0 1px 2px rgba(232, 92, 74, 0.3),
    inset 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* ======================
   CLOSE BUTTON - Minimal but Clickable
   ====================== */

.driver-popover.moleskine-tour-popover .driver-popover-close-btn {
  position: absolute;
  top: 16px;
  right: 16px;
  width: 32px;
  height: 32px;
  padding: 0;

  background: var(--mlsk-binding-light);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 150ms ease;

  display: flex;
  align-items: center;
  justify-content: center;

  color: var(--mlsk-muted);
  font-size: 18px;
}

.driver-popover.moleskine-tour-popover .driver-popover-close-btn:hover {
  background: var(--mlsk-binding);
  color: var(--mlsk-paper);
  transform: scale(1.05);
}

.driver-popover.moleskine-tour-popover .driver-popover-close-btn:active {
  transform: scale(0.98);
}

/* ======================
   MOBILE OPTIMIZATIONS
   ====================== */

@media (max-width: 640px) {
  .driver-popover.moleskine-tour-popover {
    max-width: calc(100vw - 24px);
    min-width: auto;
    margin: 0 12px;
    padding: 20px 20px 56px 28px;
  }

  /* Adjust binding width */
  .driver-popover.moleskine-tour-popover::before {
    width: 10px;
  }

  /* Ribbon smaller on mobile */
  .driver-popover.moleskine-tour-popover::after {
    width: 6px;
    height: 24px;
    left: 22px;
    top: -4px;
  }

  /* Larger touch targets */
  .driver-popover.moleskine-tour-popover .driver-popover-prev-btn,
  .driver-popover.moleskine-tour-popover .driver-popover-next-btn {
    padding: 12px 20px;
    min-height: 44px;
    font-size: 0.9375rem;
  }

  .driver-popover.moleskine-tour-popover .driver-popover-close-btn {
    width: 36px;
    height: 36px;
    top: 12px;
    right: 12px;
  }

  /* Stack buttons on very small screens */
  @media (max-width: 360px) {
    .driver-popover.moleskine-tour-popover .driver-popover-navigation-btns {
      flex-direction: column;
      width: 100%;
    }

    .driver-popover.moleskine-tour-popover .driver-popover-prev-btn,
    .driver-popover.moleskine-tour-popover .driver-popover-next-btn {
      width: 100%;
    }
  }

  /* Progress text repositioned */
  .driver-popover.moleskine-tour-popover .driver-popover-progress-text {
    position: relative;
    bottom: auto;
    left: auto;
    margin-bottom: 16px;
    text-align: center;
    display: block;
  }

  .driver-popover.moleskine-tour-popover .driver-popover-footer {
    padding-left: 0;
    flex-direction: column;
    gap: 12px;
  }
}

/* ======================
   ANIMATIONS
   ====================== */

.driver-popover.moleskine-tour-popover {
  animation: notebookPageOpen 280ms cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes notebookPageOpen {
  0% {
    opacity: 0;
    transform: translateY(12px) scale(0.96);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Page turn effect for step transitions */
.driver-popover.moleskine-tour-popover.driver-popover-animate {
  animation: pageTurn 200ms ease-out;
}

@keyframes pageTurn {
  0% {
    opacity: 0.6;
    transform: translateX(-8px);
  }
  100% {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ======================
   ACCESSIBILITY
   ====================== */

/* Focus visible states */
.driver-popover.moleskine-tour-popover .driver-popover-prev-btn:focus-visible,
.driver-popover.moleskine-tour-popover .driver-popover-next-btn:focus-visible {
  outline: 2px solid var(--mlsk-binding);
  outline-offset: 2px;
}

.driver-popover.moleskine-tour-popover .driver-popover-close-btn:focus-visible {
  outline: 2px solid var(--mlsk-binding);
  outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .driver-popover.moleskine-tour-popover {
    border: 2px solid var(--mlsk-ink);
  }

  .driver-popover.moleskine-tour-popover .driver-popover-prev-btn {
    border-width: 2px;
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .driver-popover.moleskine-tour-popover {
    animation: none;
  }

  .driver-popover.moleskine-tour-popover .driver-popover-prev-btn:hover,
  .driver-popover.moleskine-tour-popover .driver-popover-next-btn:hover,
  .driver-popover.moleskine-tour-popover .driver-popover-close-btn:hover {
    transform: none;
  }
}

/* ======================
   SPECIAL STATES
   ====================== */

/* First step - slightly larger welcome */
.driver-popover.moleskine-tour-popover[data-step="0"] .driver-popover-title {
  font-size: 1.375rem;
}

/* Last step - "Got it!" button has extra emphasis */
.driver-popover.moleskine-tour-popover .driver-popover-next-btn[data-is-done="true"] {
  padding: 10px 24px;
  font-weight: 600;
}
